<form [formGroup]="formMetaData">
    @if (uploadId()) {
        <mat-form-field appearance="fill">
            <mat-label>Choose the main file</mat-label>
            <mat-select id="mainFile" formControlName="mainFile" (selectionChange)="changeMainFile()">
                @for (file of uploadFiles; track file) {
                    <mat-option [value]="file">
                        {{ file }}
                    </mat-option>
                }
            </mat-select>
        </mat-form-field>
    } @else {
        <mat-form-field appearance="fill">
            <mat-label>Specify the main file</mat-label>
            <input matInput type="text" formControlName="mainFile" />
        </mat-form-field>
    }

    @if (uploadId() || volumeName()) {
        <div class="actions">
            <button type="submit" mat-raised-button (click)="loadLayers()">Load File Layers</button>
        </div>

        <mat-form-field appearance="fill">
            <mat-label>Choose the layer</mat-label>
            <mat-select id="layerName" formControlName="layerName">
                @for (layer of uploadFileLayers; track layer) {
                    <mat-option [value]="layer">
                        {{ layer }}
                    </mat-option>
                }
            </mat-select>
        </mat-form-field>

        <div class="actions">
            <button type="submit" mat-raised-button (click)="reloadSuggestion()">Suggest configuration</button>
        </div>
    } @else {
        <mat-form-field appearance="fill">
            <mat-label>Specify the layer name</mat-label>
            <input matInput type="text" formControlName="layerName" />
        </mat-form-field>
    }

    <mat-form-field appearance="fill">
        <mat-label>Data Type</mat-label>
        <mat-select formControlName="dataType">
            @for (dataType of vectorDataTypes; track dataType) {
                <mat-option [value]="dataType">
                    {{ dataType }}
                </mat-option>
            }
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Time Type</mat-label>
        <mat-select formControlName="timeType" (selectionChange)="changeTimeType()">
            @for (timeType of timeTypes; track timeType) {
                <mat-option [value]="timeType">
                    {{ timeType }}
                </mat-option>
            }
        </mat-select>
    </mat-form-field>

    @if (formMetaData.controls.timeType.value; as time) {
        @if (time !== 'None') {
            <mat-form-field appearance="fill">
                <mat-label>Name of column containing start</mat-label>
                <input matInput type="text" formControlName="timeStartColumn" />
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Format of column containing start</mat-label>
                <mat-select formControlName="timeStartFormat" (selectionChange)="changeTimeStartFormat()">
                    @for (timeFormat of timeFormats; track timeFormat) {
                        <mat-option [value]="timeFormat">
                            {{ timeFormat }}
                        </mat-option>
                    }
                </mat-select>
            </mat-form-field>
            @if (formMetaData.controls.timeStartFormat.value === 'custom') {
                <mat-form-field appearance="fill">
                    <mat-label>Custom format of columns containing start</mat-label>
                    <input matInput type="text" formControlName="timeStartFormatCustom" />
                </mat-form-field>
            }
            @if (formMetaData.controls.timeStartFormat.value === 'unixTimeStamp') {
                <mat-form-field appearance="fill">
                    <mat-label>Type of Unix Timestamp</mat-label>
                    <mat-select formControlName="timeStartFormatUnix">
                        @for (timestampType of timestampTypes; track timestampType) {
                            <mat-option [value]="timestampType">
                                {{ timestampType }}
                            </mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            }
        }
        @if (formMetaData.controls.timeType.value === 'Start/Duration') {
            <mat-form-field appearance="fill">
                <mat-label>Name of column containing duration</mat-label>
                <input matInput type="text" formControlName="timeDurationColumn" />
            </mat-form-field>
        }
        @if (formMetaData.controls.timeType.value === 'Start') {
            <mat-form-field appearance="fill">
                <mat-label>Duration type of feature validity</mat-label>
                <mat-select formControlName="timeDurationValueType" (selectionChange)="changeTimeDurationValueType()">
                    @for (valueType of timeDurationValueTypes; track valueType) {
                        <mat-option [value]="valueType">
                            {{ valueType }}
                        </mat-option>
                    }
                </mat-select>
            </mat-form-field>
        }
        @if (formMetaData.controls.timeDurationValueType.value === 'value') {
            <mat-form-field appearance="fill">
                <mat-label>Granularity of Duration</mat-label>
                <mat-select placeholder="Time Granularity" formControlName="timeDurationGranularity">
                    @for (granularity of timeGranularityOptions; track granularity) {
                        <mat-option [value]="granularity">{{ granularity }}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Duration Value</mat-label>
                <input matInput type="number" formControlName="timeDurationValue" />
            </mat-form-field>
        }
        @if (time === 'Start/End') {
            <mat-form-field appearance="fill">
                <mat-label>Name of column containing end</mat-label>
                <input matInput type="text" formControlName="timeEndColumn" />
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Format of column containing end</mat-label>
                <mat-select formControlName="timeEndFormat" (selectionChange)="changeTimeEndFormat()">
                    @for (timeFormat of timeFormats; track timeFormat) {
                        <mat-option [value]="timeFormat">
                            {{ timeFormat }}
                        </mat-option>
                    }
                </mat-select>
            </mat-form-field>
            @if (formMetaData.controls.timeEndFormat.value === 'custom') {
                <mat-form-field appearance="fill">
                    <mat-label>Custom format of columns containing end</mat-label>
                    <input matInput type="text" formControlName="timeEndFormatCustom" />
                </mat-form-field>
            }
            @if (formMetaData.controls.timeEndFormat.value === 'unixTimeStamp') {
                <mat-form-field appearance="fill">
                    <mat-label>Type of Unix Timestamp</mat-label>
                    <mat-select formControlName="timeEndFormatUnix">
                        @for (timestampType of timestampTypes; track timestampType) {
                            <mat-option [value]="timestampType">
                                {{ timestampType }}
                            </mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            }
        }
    }

    <div fxLayout="row">
        <mat-form-field appearance="fill" class="example-full-width">
            <mat-label>Geometry column 1</mat-label>
            <input matInput type="text" formControlName="columnsX" />
        </mat-form-field>

        <mat-form-field appearance="fill" class="example-full-width">
            <mat-label>Geometry column 2</mat-label>
            <input matInput type="text" formControlName="columnsY" />
        </mat-form-field>
    </div>

    <mat-form-field class="example-chip-list">
        <mat-label>Text Columns</mat-label>
        <mat-chip-grid #columnTextList formControlName="columnsText">
            @for (column of formMetaData.controls.columnsText.value; track column) {
                <mat-chip-row (removed)="removeText(column)">
                    {{ column }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip-row>
            }
            <input placeholder="New column..." [matChipInputFor]="columnTextList" (matChipInputTokenEnd)="addText($event)" />
        </mat-chip-grid>
    </mat-form-field>

    <mat-form-field class="example-chip-list">
        <mat-label>Float Columns</mat-label>
        <mat-chip-grid #columnNumericList formControlName="columnsFloat">
            @for (column of formMetaData.controls.columnsFloat.value; track column) {
                <mat-chip-row (removed)="removeFloat(column)">
                    {{ column }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip-row>
            }
            <input placeholder="New column..." [matChipInputFor]="columnNumericList" (matChipInputTokenEnd)="addFloat($event)" />
        </mat-chip-grid>
    </mat-form-field>

    <mat-form-field class="example-chip-list">
        <mat-label>Integer Columns</mat-label>
        <mat-chip-grid #columnDecimalList formControlName="columnsInt">
            @for (column of formMetaData.controls.columnsInt.value; track column) {
                <mat-chip-row (removed)="removeInt(column)">
                    {{ column }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip-row>
            }
            <input placeholder="New column..." [matChipInputFor]="columnDecimalList" (matChipInputTokenEnd)="addInt($event)" />
        </mat-chip-grid>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Error Handling</mat-label>
        <mat-select formControlName="errorHandling">
            @for (errorHandling of errorHandlings; track errorHandling) {
                <mat-option [value]="errorHandling">
                    {{ errorHandling }}
                </mat-option>
            }
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Spatial Reference</mat-label>
        <input matInput type="text" formControlName="spatialReference" />
    </mat-form-field>
</form>
